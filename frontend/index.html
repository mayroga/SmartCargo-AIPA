<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SMARTCARGO-AIPA</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Estilos bÃ¡sicos -->
<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: #f2f4f7;
  margin: 0;
  padding: 0;
}
.container {
  max-width: 1300px;
  margin: 30px auto;
  background: #fff;
  padding: 30px 40px;
  border-radius: 14px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.08);
}
h1 { margin-top:0; color:#002b5c;}
.subtitle { color:#555; margin-bottom:20px; }

.level {
  margin-bottom: 25px;
  border: 1px solid #ddd;
  border-radius: 10px;
  overflow: hidden;
}
.level-header {
  background:#004080;
  color:white;
  padding:14px 18px;
  font-size:17px;
  cursor:pointer;
}
.level-content { display:none; padding:20px; background:#fafafa; }

.question { margin-bottom:18px; }
.question-title { font-weight:600; margin-bottom:8px; color:#222; }
.options label { display:block; margin-bottom:6px; cursor:pointer; }
.options input { margin-right:8px; }

.actions { text-align:center; margin-top:25px; }
button {
  background:#004080;
  color:white;
  border:none;
  padding:12px 26px;
  font-size:16px;
  border-radius:8px;
  cursor:pointer;
  margin:6px;
}
button:hover { background:#0066cc; }

#result {
  margin-top:25px;
  padding:20px;
  border-radius:12px;
  display:none;
  background:#e8f0fe;
}
.green { color:#0a8f08; }
.yellow { color:#d4a000; }
.red { color:#c00000; }

input[type=number] { width:80px; padding:4px; margin-right:8px; }
</style>
</head>

<body>
<div class="container">
<h1>SMARTCARGO-AIPA</h1>
<p class="subtitle">
Preventive Cargo Acceptance Advisory System â€“ Operational Â· Legal Â· Non-binding
</p>

<!-- Usuario IA experta -->
<div class="question">
  <div class="question-title">IA Experta Login</div>
  <div class="options">
    <label>Username: <input type="text" id="iaUser" placeholder="Username"></label>
    <label>Password: <input type="password" id="iaPass" placeholder="Password"></label>
  </div>
</div>

<div id="levels"></div>

<div class="actions">
  <button onclick="submitForm()">Validate Cargo</button>
  <button onclick="location.reload()">Clear</button>
  <button onclick="downloadPDF()">Download PDF</button>
  <button onclick="sendWhatsApp()">Send via WhatsApp</button>
</div>

<div id="result">
  <h2 id="semaphore"></h2>
  <div id="recommendations"></div>
  <div id="volume-weight"></div>
</div>
</div>

<script>
// ================== DATOS DE LOS NIVELES Y PREGUNTAS ==================
const levels = [
  { title:"Level 1 â€“ Identification & Transport", q:[
    {id:1,text:"Type of cargo"}, {id:2,text:"Delivered by"}, {id:3,text:"Ground transport type"}, {id:4,text:"Cargo condition at receipt"},
    {id:5,text:"Max pallet/bundle height (cm/in)", type:"dimension"}, {id:6,text:"Max pallet/bundle length (cm/in)", type:"dimension"}, 
    {id:7,text:"Truck seal present"}, {id:8,text:"Truck cleanliness"}
  ]},
  { title:"Level 2 â€“ Documentation", q:[
    {id:9,text:"Original AWB present"}, {id:10,text:"AWB & document copies"}, {id:11,text:"Document readability"},
    {id:12,text:"Shipper name consistent"}, {id:13,text:"AWB matches physical cargo"},
    {id:14,text:"Invoices & packing list organized"}, {id:15,text:"Master / House AWB aligned"}, {id:16,text:"Origin / sanitary seals"}
  ]},
  { title:"Level 3 â€“ Pallets & Packaging", q:[
    {id:17,text:"Pallet type compliant"}, {id:18,text:"Pallet wrapping adequate"}, {id:19,text:"Height compliance"},
    {id:20,text:"Labels visible"}, {id:21,text:"Cargo segregated"}
  ]},
  { title:"Level 4 â€“ Special Cargo Handling", q:[
    {id:22,text:"Pharma: Temp controlled, SLI, packaging"}, {id:23,text:"DG declaration & labels"}, {id:24,text:"Perishables: Temp & ventilation"},
    {id:25,text:"Human Remains: Documents & coffin check"}, {id:26,text:"Security & escort if required"}
  ]},
  { title:"Level 5 â€“ Final Compliance", q:[
    {id:27,text:"Weight correctly declared"}, {id:28,text:"Dimensions correctly declared"}, {id:29,text:"No prohibited items"},
    {id:30,text:"No leaks detected"}, {id:31,text:"Stacking allowed"}, {id:32,text:"ULD compatible"},
    {id:33,text:"Acceptance checklist complete"}, {id:34,text:"Supervisor approval"}, {id:35,text:"Final compliance confirmed"}
  ]}
];

let qId = 1;
const container = document.getElementById("levels");

// ================== CREACIÃ“N DE CHECKLIST PLEGABLE ==================
levels.forEach(lvl=>{
  const levelDiv = document.createElement("div");
  levelDiv.className = "level";

  const header = document.createElement("div");
  header.className = "level-header";
  header.textContent = lvl.title;
  header.onclick = ()=> { content.style.display = content.style.display==="block"?"none":"block"; };

  const content = document.createElement("div");
  content.className = "level-content";

  lvl.q.forEach(q=>{
    const d = document.createElement("div");
    d.className="question";

    let html = `<div class="question-title">${qId}. ${q.text}</div><div class="options">`;
    html += `<label><input type="radio" name="q${qId}" value="ok"> Compliant</label>`;
    html += `<label><input type="radio" name="q${qId}" value="warn"> Requires Review</label>`;
    html += `<label><input type="radio" name="q${qId}" value="fail"> Not Compliant</label>`;
    if(q.type==="dimension"){
      html += `<br><label>Height (cm): <input type="number" id="height${qId}" min="0"></label>`;
      html += `<label>Width (cm): <input type="number" id="width${qId}" min="0"></label>`;
      html += `<label>Length (cm): <input type="number" id="length${qId}" min="0"></label>`;
    }
    html += `</div>`;
    d.innerHTML = html;
    content.appendChild(d);
    qId++;
  });

  levelDiv.appendChild(header);
  levelDiv.appendChild(content);
  container.appendChild(levelDiv);
});

// ================== FUNCIONES ==================
function submitForm(){
  const answers = {};
  document.querySelectorAll("input[type=radio]:checked").forEach(r=>{
    answers[r.name] = r.value;
  });

  // Calcular volumen total si hay dimensiones
  let totalVolume=0, totalWeight=0;
  for(let i=1;i<qId;i++){
    const h = parseFloat(document.getElementById(`height${i}`)?.value || 0);
    const w = parseFloat(document.getElementById(`width${i}`)?.value || 0);
    const l = parseFloat(document.getElementById(`length${i}`)?.value || 0);
    if(h && w && l){ totalVolume += h*w*l; } // cm3
  }

  fetch("/validate",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({answers})
  })
  .then(r=>r.json())
  .then(res=>{
    document.getElementById("result").style.display="block";
    const sem=document.getElementById("semaphore");
    sem.className="";
    if(res.status==="GREEN"){sem.textContent="ðŸŸ¢ GREEN â€“ ACCEPTED"; sem.classList.add("green");}
    else if(res.status==="YELLOW"){sem.textContent="ðŸŸ¡ YELLOW â€“ CONDITIONAL"; sem.classList.add("yellow");}
    else{sem.textContent="ðŸ”´ RED â€“ NOT ACCEPTED"; sem.classList.add("red");}

    document.getElementById("recommendations").innerHTML = res.recommendations.join("<br>");
    document.getElementById("volume-weight").innerHTML = `Total Volume: ${totalVolume.toLocaleString()} cmÂ³`;
  });
}

function downloadPDF(){
  alert("Function to generate PDF will be implemented in next version.");
}

function sendWhatsApp(){
  alert("Function to send report via WhatsApp will be implemented in next version.");
}
</script>

</body>
</html>

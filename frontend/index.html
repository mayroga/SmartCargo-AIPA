<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMARTCARGO BY MAY ROGA LLC</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        :root { --primary: #d8232a; --secondary: #003366; --accent: #f4f4f4; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--accent); }
        header { background: var(--secondary); color: white; padding: 20px; text-align: center; border-bottom: 5px solid var(--primary); }
        .container { max-width: 900px; margin: 20px auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .question-card { border-bottom: 1px solid #eee; padding: 15px 0; display: flex; justify-content: space-between; align-items: center; }
        .question-info { flex: 2; }
        .question-desc { font-weight: bold; display: block; margin-bottom: 5px; }
        .question-tip { font-size: 12px; color: #666; font-style: italic; }
        select { padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-weight: bold; }
        .actions { display: flex; gap: 15px; margin-top: 30px; }
        .btn { flex: 1; padding: 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; text-transform: uppercase; color: white; }
        .btn-validate { background: var(--primary); }
        .btn-clear { background: #555; }
        #result { margin-top: 30px; padding: 20px; border-radius: 10px; display: none; }
    </style>
</head>
<body>

<header>
    <h1>SMARTCARGO BY MAY ROGA LLC</h1>
    <p>Asesoría Técnica Especializada en Carga Aérea (Avianca Cargo SOP)</p>
</header>

<div class="container">
    <div id="questions-container">
        <p style="text-align:center;">Cargando estándares técnicos de Avianca...</p>
    </div>

    <div id="result"></div>

    <div class="actions">
        <button class="btn btn-validate" onclick="processValidation()">Validar Cumplimiento</button>
        <button class="btn btn-clear" onclick="location.reload()">Borrar Todo</button>
    </div>
</div>

<script>
    // CAMBIAR POR TU URL DE RENDER
    const API_BASE = "https://smartcargo-aipa.onrender.com";

    // Función para cargar preguntas desde el Models.py a través del API
    async function loadQuestions() {
        try {
            const res = await axios.get(`${API_BASE}/questions`);
            const container = document.getElementById('questions-container');
            container.innerHTML = ""; // Limpiar mensaje de carga

            res.data.forEach(q => {
                container.innerHTML += `
                    <div class="question-card">
                        <div class="question-info">
                            <span class="question-desc">${q.description}</span>
                            <span class="question-tip">${q.tip} (${q.authority})</span>
                        </div>
                        <select id="${q.id}">
                            <option value="ok">CUMPLE</option>
                            <option value="warn">OBSERVACIÓN</option>
                            <option value="fail">FALLA / RECHAZO</option>
                        </select>
                    </div>
                `;
            });
        } catch (e) {
            alert("Error: No se pudo conectar con el cerebro de SMARTCARGO en Render.");
        }
    }

    async function processValidation() {
        // Recoger respuestas dinámicamente
        const selects = document.querySelectorAll('select');
        const answers = {};
        selects.forEach(s => { answers[s.id] = s.value; });

        const operator = prompt("ID del Operador (Counter):", "USER_01");

        try {
            const res = await axios.post(`${API_BASE}/validate`, {
                answers: answers,
                operator: operator,
                cargo_type: "General Cargo"
            });

            const d = res.data;
            const resDiv = document.getElementById('result');
            resDiv.style.display = "block";
            
            // Colores de autoridad
            let bgColor = "#d4edda"; // Verde
            if (d.status.includes("YELLOW")) bgColor = "#fff3cd"; // Amarillo
            if (d.status.includes("RED")) bgColor = "#f8d7da"; // Rojo

            resDiv.style.background = bgColor;
            resDiv.innerHTML = `
                <h2 style="margin-top:0;">${d.status}</h2>
                <p><strong>REPORT ID:</strong> ${d.report_id}</p>
                <hr>
                <strong>RECOMENDACIONES TÉCNICAS:</strong>
                <ul>${d.recommendations.map(r => `<li>${r}</li>`).join("")}</ul>
                <br>
                <small>${d.legal_note}</small>
            `;
            resDiv.scrollIntoView({behavior: "smooth"});

        } catch (e) {
            alert("Error al procesar la validación.");
        }
    }

    // Iniciar carga al abrir
    loadQuestions();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SMARTCARGO-AIPA</title>
<link rel="stylesheet" href="/static/styles.css">
<script defer src="/static/scripts.js"></script>
</head>

<body>
<div class="box">

<h2>SMARTCARGO-AIPA</h2>

<div class="banner">
Avoid rejections 路 Delays 路 Fines 路 Save time, effort and money
</div>

<!--  REPORTE -->
<p id="reportId" style="font-size:13px;color:#555;"></p>

<select id="lang" onchange="switchLang()">
  <option value="English">English</option>
  <option value="Spanish">Spanish</option>
</select>

<label id="roleLabel">Role</label>
<select id="role">
  <option>Shipper</option>
  <option>Driver</option>
  <option>Warehouse</option>
  <option>Counter</option>
</select>

<textarea
  id="dossier"
  placeholder="Paste FULL documentary file reviewed at counter">
</textarea>

<button id="validateBtn" onclick="validateCargo()">Validate Cargo</button>
<button onclick="clearAll()">Ч Clear</button>

<div id="result" class="hidden">

  <h3 id="semaforo"></h3>

  <!-- RESULTADO -->
  <div id="analysis" class="analysis-box"></div>

  <!-- BLINDAJE LEGAL -->
  <div class="analysis-box" style="margin-top:22px;">
    <strong>LEGAL & COMPLIANCE NOTICE</strong><br><br>

    This report was generated by
    <strong>SMARTCARGO-AIPA by May Roga LLC</strong> as a
    <strong>preventive, non-binding advisory analysis</strong>.<br><br>

    This system does not replace or override decisions made by
    airlines, cargo agents, or government authorities including
    TSA, CBP, DOT, ICAO, or IATA.<br><br>

    Final responsibility for cargo acceptance, documentation
    accuracy, and regulatory compliance remains with the user.<br><br>

    Purpose: reduce rejections, delays, penalties, and financial loss.
  </div>

  <button onclick="speakResult()"> Listen</button>
  <button onclick="sendWhatsApp()"> WhatsApp</button>
  <button onclick="window.print()"> PDF</button>
</div>

<hr>

<h3>Admin Login</h3>
<input id="adminUser" placeholder="Username">
<input id="adminPass" type="password" placeholder="Password">
<textarea id="adminQ" placeholder="Admin question"></textarea>
<button onclick="askAdmin()">Ask</button>
<pre id="adminAnswer"></pre>

</div>

<script>
//  GENERADOR DE NMERO NICO DE REPORTE
(function generateReportId() {
  const now = new Date();
  const id =
    "SCR-AIPA-" +
    now.getFullYear() +
    (now.getMonth()+1).toString().padStart(2,"0") +
    now.getDate().toString().padStart(2,"0") + "-" +
    Math.random().toString(36).substring(2,8).toUpperCase();

  document.getElementById("reportId").innerText =
    "Report ID: " + id + " 路 Generated: " + now.toLocaleString();
})();

// ---------------- FUNCIONES ----------------
async function validateCargo() {
  const role = document.getElementById("role").value;
  const lang = document.getElementById("lang").value;
  const dossier = document.getElementById("dossier").value;

  if (!dossier.trim()) return alert("Please paste the cargo documentation.");

  const formData = new FormData();
  formData.append("role", role);
  formData.append("lang", lang);
  formData.append("dossier", dossier);

  const res = await fetch("/validate", { method: "POST", body: formData });
  const data = await res.json();

  document.getElementById("semaforo").innerText = "Status: " + data.status;
  document.getElementById("analysis").innerText = data.analysis;
  document.getElementById("result").classList.remove("hidden");
}

function clearAll() {
  document.getElementById("dossier").value = "";
  document.getElementById("analysis").innerText = "";
  document.getElementById("semaforo").innerText = "";
  document.getElementById("result").classList.add("hidden");
  document.getElementById("adminQ").value = "";
  document.getElementById("adminAnswer").innerText = "";
}

async function askAdmin() {
  const username = document.getElementById("adminUser").value;
  const password = document.getElementById("adminPass").value;
  const question = document.getElementById("adminQ").value;

  if (!username || !password || !question) return alert("Fill all fields.");

  const formData = new FormData();
  formData.append("username", username);
  formData.append("password", password);
  formData.append("question", question);

  const res = await fetch("/admin", { method: "POST", body: formData });
  if (res.status === 401) {
    document.getElementById("adminAnswer").innerText = "Access Denied";
    return;
  }

  const data = await res.json();
  document.getElementById("adminAnswer").innerText = data.answer;
}

// Placeholder funciones para voz y WhatsApp
function speakResult() { alert("Voice function coming soon."); }
function sendWhatsApp() { alert("WhatsApp function coming soon."); }
function switchLang() { /* Opcional: cambiar labels seg煤n idioma */ }
</script>

</body>
</html>

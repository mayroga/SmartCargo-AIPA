<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SMARTCARGO-AIPA</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: #f2f4f7;
  margin: 0;
  padding: 0;
}

.container {
  max-width: 1200px;
  margin: 30px auto;
  background: #ffffff;
  padding: 30px 40px;
  border-radius: 14px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.08);
}

h1 {
  margin-top: 0;
  color: #002b5c;
}

.subtitle {
  color: #555;
  margin-bottom: 30px;
}

.level {
  margin-bottom: 25px;
  border-radius: 10px;
  overflow: hidden;
  border: 1px solid #0073e6;
}

.level-header {
  background: #0073e6;
  color: white;
  padding: 14px 18px;
  font-size: 17px;
  cursor: pointer;
  font-weight: 600;
}

.level-content {
  display: none;
  padding: 20px;
  background: #f0f8ff;
}

.question {
  margin-bottom: 18px;
}

.question-title {
  font-weight: 600;
  margin-bottom: 8px;
  color: #222;
}

.options label {
  display: block;
  margin-bottom: 6px;
  cursor: pointer;
}

.options input {
  margin-right: 8px;
}

.actions {
  text-align: center;
  margin-top: 35px;
}

button {
  background: #0073e6;
  color: white;
  border: none;
  padding: 14px 26px;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
  margin: 8px;
}

button:hover {
  background: #005bb5;
}

#result {
  margin-top: 35px;
  padding: 25px;
  border-radius: 12px;
  display: none;
  background: #e6f2ff;
}

.green { color: #0a8f08; font-weight: 700; }
.yellow { color: #d4a000; font-weight: 700; }
.red { color: #c00000; font-weight: 700; }

</style>
</head>
<body>

<div class="container">
<h1>SMARTCARGO-AIPA</h1>
<p class="subtitle">
Preventive Cargo Acceptance Advisory System<br>
Operational Â· Legal Â· Non-binding
</p>

<div id="levels"></div>

<div class="actions">
  <button onclick="submitForm()">Validate Cargo</button>
  <button onclick="location.reload()">Clear / New Service</button>
</div>

<div id="result">
  <h2 id="semaphore"></h2>
  <div id="recommendations"></div>
</div>

<script>
// =========================
// DEFINICION DE NIVELES Y PREGUNTAS
// =========================
const levelsData = [
  { title:"Level 1 â€“ Identification & Transport", questions:[
    "Type of cargo","Who delivers","Land transport method","Cargo condition upon receipt",
    "Max pallet/bundle height","Max pallet/bundle length","Truck seal type","Truck cleanliness"
  ]},
  { title:"Level 2 â€“ Documentation", questions:[
    "Original AWB present","AWB and documents copies","Document writing",
    "Shipper name matches invoice/documents","AWB matches physical cargo",
    "Invoices, packing list, permits organized","Consolidated/master vs house AWB in order","Origin/Phytosanitary seal correct"
  ]},
  { title:"Level 3 â€“ Pallets & Packaging", questions:[
    "Pallet type","Pallet wrapping","Pallets meet max height",
    "Labels visible","Cargo mix"
  ]},
  { title:"Level 4 â€“ Cargo Specific",
   questions:[
    "Pharmaceutical: Classification","Pharmaceutical: Temperature range","Pharmaceutical: Dry ice",
    "Pharmaceutical: SLI signed","Pharmaceutical: Packaging validated","Pharmaceutical: Additional documents",
    "Pharmaceutical: Temperature recorded","Pharmaceutical: Expiry dates legible",
    "DG: Declared in AWB","DG: Class","DG: DGD signed by certified person",
    "DG: UN packaging approved","DG: Labels visible","DG: DG mixed with other cargo",
    "DG: Fragile / Handle With Care labels","Perishables: Type","Perishables: Temperature compliant",
    "Perishables: Packaging ventilated","Perishables: Transit time compatible",
    "Human Remains: Required documents","Human Remains: Coffin compliant","Human Remains: AWB declared",
    "General Cargo: Packing list separate","General Cargo: Invoices and permits organized","General Cargo: Weight & dimensions match",
    "General Cargo: Special consolidated/unified documents","General Cargo: Belly cargo approval","General Cargo: Not mixed with DG or perishables"
   ]
  },
  { title:"Level 5 â€“ Final Compliance", questions:[
    "Record semaphore and finalize report"
  ]}
];

// =========================
// GENERAR HTML DINAMICO
// =========================
let qId = 1;
const container = document.getElementById("levels");

levelsData.forEach(lvl=>{
  const levelDiv = document.createElement("div");
  levelDiv.className="level";

  const header = document.createElement("div");
  header.className="level-header";
  header.textContent = lvl.title;
  header.onclick = ()=> {
    content.style.display = content.style.display==="block"?"none":"block";
  };

  const content = document.createElement("div");
  content.className="level-content";

  lvl.questions.forEach(q=>{
    const d = document.createElement("div");
    d.className="question";
    d.innerHTML = `
      <div class="question-title">${qId}. ${q}</div>
      <div class="options">
        <label><input type="radio" name="q${qId}" value="ok"> Compliant</label>
        <label><input type="radio" name="q${qId}" value="warn"> Requires Review</label>
        <label><input type="radio" name="q${qId}" value="fail"> Not Compliant</label>
      </div>`;
    content.appendChild(d);
    qId++;
  });

  levelDiv.appendChild(header);
  levelDiv.appendChild(content);
  container.appendChild(levelDiv);
});

// =========================
// ENVIO DEL FORMULARIO
// =========================
function submitForm(){
  const answers = {};
  document.querySelectorAll("input[type=radio]:checked").forEach(r=>{
    answers[r.name] = r.value;
  });

  fetch("/validate",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({answers})
  })
  .then(r=>r.json())
  .then(res=>{
    document.getElementById("result").style.display="block";
    const sem=document.getElementById("semaphore");
    sem.className="";
    if(res.status==="GREEN"){sem.textContent="ðŸŸ¢ GREEN â€“ ACCEPTED"; sem.classList.add("green");}
    else if(res.status==="YELLOW"){sem.textContent="ðŸŸ¡ YELLOW â€“ CONDITIONAL"; sem.classList.add("yellow");}
    else{sem.textContent="ðŸ”´ RED â€“ NOT ACCEPTED"; sem.classList.add("red");}

    document.getElementById("recommendations").innerHTML = res.recommendations.join("<br>");
  });
}
</script>

</body>
</html>

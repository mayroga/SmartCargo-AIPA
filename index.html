<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartCargo Advisory | May Roga</title>
    <style>
        :root { --red: #d32f2f; --gold: #c5a059; --black: #050505; --white: #ffffff; --gray: #1a1a1a; }
        body { background: var(--black); color: var(--white); font-family: 'Helvetica Neue', Arial, sans-serif; margin: 0; padding: 20px; }
        
        .header { text-align: center; border-bottom: 2px solid var(--gold); padding-bottom: 10px; margin-bottom: 20px; }
        .advisor-name { color: var(--gold); font-weight: bold; font-size: 1.2em; letter-spacing: 1px; }

        .lang-switch { display: flex; justify-content: flex-end; gap: 10px; margin-bottom: 15px; }
        .lang-btn { background: transparent; border: 1px solid var(--gold); color: var(--gold); padding: 5px 15px; cursor: pointer; border-radius: 4px; }
        .lang-btn.active { background: var(--gold); color: var(--black); }

        .input-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; margin-bottom: 20px; }
        input, textarea { background: var(--gray); border: 1px solid #333; color: var(--white); padding: 15px; border-radius: 8px; font-size: 16px; width: 100%; box-sizing: border-box; }
        input:focus { border-color: var(--gold); outline: none; }

        /* Photo Upload Boxes */
        .photo-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .photo-box { height: 120px; border: 2px dashed var(--gold); border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; position: relative; cursor: pointer; background: var(--gray); }
        .photo-box img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease; }
        .photo-box span { color: var(--gold); font-size: 0.9em; margin-top: 5px; }
        .photo-box.has-img span { display: none; }
        .photo-box.has-img img { display: block; }
        .photo-box img:not([src]) { display: none; } /* Ocultar img si no tiene src */

        .button-zone { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; }
        button { padding: 18px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; }
        .btn-voice { background: var(--gold); color: var(--black); grid-column: span 2; font-size: 1.1em; }
        .btn-resolve { background: var(--red); color: var(--white); }
        .btn-clear { background: #444; color: var(--white); }

        #output { 
            display: none; background: var(--white); color: var(--black); 
            padding: 30px; margin-top: 25px; border-radius: 12px; 
            line-height: 1.8; font-size: 17px; white-space: pre-wrap; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .btn-print { width: 100%; margin-top: 20px; background: var(--black); color: var(--gold); border: 2px solid var(--gold); }
        .btn-speak { width: 100%; margin-top: 10px; background: #222; color: var(--gold); border: 1px solid var(--gold); }

        table { width: 100%; border-collapse: collapse; margin: 20px 0; background: #f9f9f9; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background: #eee; }

        @media print {
            body { background: white; color: black; padding: 0; }
            .header, .input-group, button, .lang-switch, textarea, .photo-grid { display: none !important; }
            #output { display: block !important; border: none; box-shadow: none; padding: 0; }
        }
    </style>
</head>
<body>

<div class="lang-switch">
    <button class="lang-btn active" id="btn-en" onclick="setLang('en')">English</button>
    <button class="lang-btn" id="btn-es" onclick="setLang('es')">Espa√±ol</button>
</div>

<div class="header">
    <div class="advisor-name">SMARTCARGO ADVISORY by MAY ROGA</div>
    <div style="font-size: 10px; color: #888; margin-top: 5px;">AIR FREIGHT SPECIALIST CONSOLE</div>
</div>

<div class="input-group">
    <input type="text" id="awb" placeholder="AWB / ULD">
    <input type="number" id="L" placeholder="Length">
    <input type="number" id="W" placeholder="Width">
    <input type="number" id="H" placeholder="Height">
    <input type="number" id="wgt" placeholder="Weight">
</div>

<div class="photo-grid">
    <div class="photo-box" onclick="handlePhotoClick(this, 'photo1')">
        <img id="photo1-preview" src="" alt="Document Photo">
        <span>üì∏ Document / AWB</span>
        <input type="file" id="photo1" hidden onchange="previewPhoto(this, 'photo1-preview')">
    </div>
    <div class="photo-box" onclick="handlePhotoClick(this, 'photo2')">
        <img id="photo2-preview" src="" alt="Cargo Photo">
        <span>üì∏ Cargo Condition</span>
        <input type="file" id="photo2" hidden onchange="previewPhoto(this, 'photo2-preview')">
    </div>
</div>

<button class="btn-voice" id="voiceBtn">üé§ PRESS & HOLD TO DICTATE</button>
<textarea id="obs" rows="4" placeholder="Describe the cargo situation, documents, or request a classification..."></textarea>

<div class="button-zone">
    <button class="btn-clear" onclick="clearAll()">üóëÔ∏è Clear</button>
    <button class="btn-resolve" onclick="resolve()">Resolve / Resolver</button>
</div>

<div id="output">
    <div id="resTxt"></div>
    <button class="btn-speak" onclick="readResponse()">üîä Read Response / Leer Respuesta</button>
    <button class="btn-print" onclick="window.print()">üìÑ SAVE AS PDF / PRINT</button>
</div>

<script>
    let currentLang = 'en';
    const speech = window.speechSynthesis;
    
    function setLang(l) {
        currentLang = l;
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-' + l).classList.add('active');
        // Update placeholders
        document.getElementById('awb').placeholder = (l === 'es') ? 'AWB / ULD' : 'AWB / ULD';
        document.getElementById('L').placeholder = (l === 'es') ? 'Largo' : 'Length';
        document.getElementById('W').placeholder = (l === 'es') ? 'Ancho' : 'Width';
        document.getElementById('H').placeholder = (l === 'es') ? 'Alto' : 'Height';
        document.getElementById('wgt').placeholder = (l === 'es') ? 'Peso' : 'Weight';
        document.getElementById('obs').placeholder = (l === 'es') ? 'Describe la situaci√≥n, documentos o solicita una clasificaci√≥n...' : 'Describe the cargo situation, documents, or request a classification...';
        document.querySelector('.btn-voice').innerText = (l === 'es') ? 'üé§ MANT√âN PARA DICTAR' : 'üé§ PRESS & HOLD TO DICTATE';
        document.querySelector('.btn-clear').innerText = (l === 'es') ? 'üóëÔ∏è Borrar' : 'üóëÔ∏è Clear';
        document.querySelector('.btn-resolve').innerText = (l === 'es') ? 'Resolver' : 'Resolve';
        document.querySelector('.btn-print').innerText = (l === 'es') ? 'üìÑ GUARDAR PDF / IMPRIMIR' : 'üìÑ SAVE AS PDF / PRINT';
        document.querySelector('.btn-speak').innerText = (l === 'es') ? 'üîä Leer Respuesta' : 'üîä Read Response';
        document.querySelector('#photo1-preview').nextElementSibling.innerText = (l === 'es') ? 'üì∏ Documento / AWB' : 'üì∏ Document / AWB';
        document.querySelector('#photo2-preview').nextElementSibling.innerText = (l === 'es') ? 'üì∏ Estado Carga' : 'üì∏ Cargo Condition';

    }
    setLang('en'); // Default language

    const voiceBtn = document.getElementById('voiceBtn');
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.continuous = false; // Capture a single phrase

    voiceBtn.onmousedown = voiceBtn.ontouchstart = (e) => {
        e.preventDefault();
        recognition.lang = (currentLang === 'es') ? 'es-ES' : 'en-US';
        recognition.start();
        voiceBtn.style.background = "red";
    };
    voiceBtn.onmouseup = voiceBtn.ontouchend = () => {
        recognition.stop();
        voiceBtn.style.background = "";
    };
    recognition.onresult = (e) => {
        document.getElementById('obs').value += " " + e.results[0][0].transcript;
    };

    function handlePhotoClick(boxElement, inputId) {
        // Zoom functionality
        const img = boxElement.querySelector('img');
        if (img.src && img.style.display !== "none") { // If there's an image and it's visible
            img.style.transform = img.style.transform === "scale(2.5)" ? "scale(1)" : "scale(2.5)";
            img.style.position = (img.style.transform === "scale(2.5)") ? "absolute" : "static";
            img.style.zIndex = (img.style.transform === "scale(2.5)") ? "100" : "auto";
        } else {
            // Trigger file input if no image or image not visible
            document.getElementById(inputId).click();
        }
    }

    function previewPhoto(input, previewId) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = document.getElementById(previewId);
                img.src = e.target.result;
                img.style.display = 'block';
                input.closest('.photo-box').classList.add('has-img'); // Add class to hide span
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function clearAll() {
        document.querySelectorAll('input:not([type="file"]), textarea').forEach(i => i.value = "");
        document.querySelectorAll('.photo-box img').forEach(img => {
            img.src = '';
            img.style.display = 'none';
            img.style.transform = 'scale(1)'; // Reset zoom
            img.parentNode.classList.remove('has-img');
        });
        document.getElementById('output').style.display = "none";
    }

    async function resolve() {
        const out = document.getElementById('output');
        const txt = document.getElementById('resTxt');
        out.style.display = "block";
        txt.innerText = (currentLang === 'es') ? "Analizando y resolviendo..." : "Analyzing and resolving...";

        const fd = new FormData();
        fd.append('prompt', document.getElementById('obs').value);
        fd.append('awb', document.getElementById('awb').value);
        fd.append('l', document.getElementById('L').value || "0");
        fd.append('w', document.getElementById('W').value || "0");
        fd.append('h', document.getElementById('H').value || "0");
        fd.append('wgt', document.getElementById('wgt').value || "0");
        fd.append('lang', currentLang);

        const res = await fetch('/advisory', { method: 'POST', body: fd });
        const result = await res.json();
        
        txt.innerHTML = result.data.replace(/\n/g, "<br>");
    }

    function readResponse() {
        if (speech.speaking) {
            speech.cancel();
            return;
        }
        const textToRead = document.getElementById('resTxt').innerText;
        const utterance = new SpeechSynthesisUtterance(textToRead);
        utterance.lang = (currentLang === 'es') ? 'es-ES' : 'en-US';
        speech.speak(utterance);
    }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SmartCargo Advisory | MAY ROGA LLC</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css">
    <style>
        body { background: #000b1a; color: #333; font-family: sans-serif; padding: 10px; margin:0; }
        .card { max-width: 500px; margin: auto; background: white; border-radius: 20px; padding: 25px; border-top: 10px solid #d4af37; box-shadow: 0 15px 40px rgba(0,0,0,0.5); }
        .branding h2 { font-weight: 900; color: #001d3d; text-align: center; margin-bottom: 0; }
        .branding p { font-size: 12px; font-weight: bold; color: #d4af37; text-align: center; text-transform: uppercase; margin-top: 0; }
        .legal-box { background: #fff1f0; border: 2px solid #ff4d4f; border-radius: 10px; padding: 12px; color: #a8071a; font-size: 10px; text-align: center; margin-bottom: 20px; font-weight: bold; }
        .btn-opt { border: 2px solid #001d3d; padding: 10px; border-radius: 10px; text-align: center; cursor: pointer; font-size: 10px; font-weight: bold; margin-bottom: 8px; background: #f8f9fa; }
        .selected { background: #001d3d !important; color: white !important; }
        .btn-main { background: #001d3d; color: white; width: 100%; height: 50px; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; text-transform: uppercase; }
        .photo-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 10px; }
        .photo-box { width:100%; height:110px; background:#000; border:2px solid #001d3d; border-radius:8px; object-fit:contain; display:block; }
        
        /* Estilo extra para separar el m√≥dulo Vision */
        .sc-vision-wrap { border: 2px solid #d4af37; border-radius: 15px; padding: 15px; margin-top: 20px; background: #fff; }
    </style>
</head>
<body>
<div class="card">
    <div class="branding"><h2>SmartCargo ADVISORY</h2><p>Technical Consulting by MAY ROGA LLC</p></div>
    <div class="legal-box">‚ö†Ô∏è LEGAL SHIELD: WE ARE PRIVATE ADVISORS. NOT IATA/TSA/DOT. WE PROVIDE TECHNICAL SOLUTIONS; WE DON'T CERTIFY DG OR HANDLE CARGO.</div>
    
    <div id="accessSection">
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px;">
            <div class="btn-opt role-btn" onclick="selRole('Shipper', this)">Shipper</div>
            <div class="btn-opt role-btn" onclick="selRole('Forwarder', this)">Forwarder</div>
            <div class="btn-opt role-btn" onclick="selRole('Trucker', this)">Trucker</div>
            <div class="btn-opt role-btn" onclick="selRole('Operator', this)">Operator</div>
        </div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px; margin-top:10px;">
            <div class="btn-opt tier-btn" onclick="selTier(5, this)">Courier ($5)</div>
            <div class="btn-opt tier-btn" onclick="selTier(15, this)">Standard ($15)</div>
            <div class="btn-opt tier-btn" onclick="selTier(35, this)">Critical ($35)</div>
            <div class="btn-opt tier-btn" onclick="selTier(95, this)">Project ($95)</div>
        </div>
        <input type="text" id="awbField" class="u-full-width" placeholder="Reference / AWB" style="margin-top:10px;">
        <button id="activateBtn" class="btn-main">Validate & Access</button>

        <div id="sc-vision" class="sc-vision-wrap">
            <h3 style="color:#001d3d; margin:0; font-size: 18px; text-align: center;">SmartCargo VISION</h3>
            <p style="font-size:10px; color:#d4af37; font-weight:bold; margin-bottom:15px; text-align: center;">MAY ROGA LLC - T√âCNICO EXPERTO</p>

            <select id="userLang" style="width:100%; padding:8px; margin-bottom:10px; border:1px solid #d4af37; border-radius:5px; font-weight:bold; color:#001d3d;">
                <option value="es">Traducir a: ESPA√ëOL üá™üá∏</option>
                <option value="en">Translate to: ENGLISH üá∫üá∏</option>
            </select>

            <div onclick="document.getElementById('cargoFile').click()" style="width:100%; height:180px; background:#000; border-radius:10px; cursor:pointer; display:flex; align-items:center; justify-content:center; overflow:hidden; margin-bottom:15px; border:1px solid #ddd;">
                <img id="scPreview" style="max-width:100%; max-height:100%; display:none;">
                <span id="scLabel" style="color:#fff; font-size:12px;">üì∑ TOCAR PARA TIRAR FOTO</span>
                <input type="file" id="cargoFile" accept="image/*" capture="environment" style="display:none;" onchange="capturarLectura(event)">
            </div>

            <button id="scAction" onclick="enviarAnalisis()" style="width:100%; background:#001d3d; color:white; border:none; padding:12px; border-radius:10px; font-weight:bold; cursor:pointer; font-size:14px;">ANALYZE NOW</button>
            <div id="scOutput" style="margin-top:15px; text-align:left; font-size:12px; color:#333; white-space:pre-wrap; border-top:1px solid #eee; padding-top:10px;"></div>
        </div>
    </div>

    <div id="mainApp" style="display:none;">
        <div id="timerDisp" style="background:#d4af37; text-align:center; font-weight:bold; padding:10px; margin-bottom:10px; border-radius:10px;"></div>
        <div class="photo-grid">
            <div onclick="document.getElementById('f1').click()"><img id="p1" class="photo-box"><input type="file" id="f1" style="display:none" onchange="loadPhoto(1)"></div>
            <div onclick="document.getElementById('f2').click()"><img id="p2" class="photo-box"><input type="file" id="f2" style="display:none" onchange="loadPhoto(2)"></div>
            <div onclick="document.getElementById('f3').click()"><img id="p3" class="photo-box"><input type="file" id="f3" style="display:none" onchange="loadPhoto(3)"></div>
        </div>
        
        <div style="position:relative;">
            <textarea id="promptArea" class="u-full-width" style="height:100px;" placeholder="Describe issue..."></textarea>
            <div style="position:absolute; right:10px; top:10px; display:flex; flex-direction:column; gap:5px;">
                <button onclick="startVoice()" style="border:none; background:none; font-size:20px; cursor:pointer;" title="Voice">üé§</button>
                <button onclick="clearText()" style="border:none; background:none; font-size:18px; cursor:pointer;" title="Clear">üóëÔ∏è</button>
            </div>
        </div>

        <button id="btnSolve" class="btn-main" style="background:#1b5e20;" onclick="getSolution()">Get Solution</button>
        <div id="advResponse" style="margin-top:15px; font-size:14px; white-space:pre-wrap;"></div>
        <button id="btnWs" class="btn-main" style="background:#25D366; margin-top:10px; display:none;" onclick="sendWS()">üì© WhatsApp</button>
    </div>
</div>

<script>
    let laLecturaDirecta = "";

    function capturarLectura(e) {
        const reader = new FileReader();
        reader.onload = () => {
            document.getElementById('scPreview').src = reader.result;
            document.getElementById('scPreview').style.display = "block";
            document.getElementById('scLabel').style.display = "none";
            laLecturaDirecta = reader.result; // LA LLAVE: Los bits reales que Gemini leer√°
        };
        reader.readAsDataURL(e.target.files[0]);
    }

    async function enviarAnalisis() {
        if(!laLecturaDirecta) return alert("Por favor, tome una foto primero.");
        const output = document.getElementById('scOutput');
        const lang = document.getElementById('userLang').value;
        const btn = document.getElementById('scAction');
        
        output.innerHTML = "<b>MAY ROGA LLC:</b> Procesando imagen t√©cnica...";
        btn.disabled = true;
        
        const fd = new FormData();
        // Prompt forzado para que Gemini NO diga que no puede ver
        fd.append("prompt", "Analyze the labels and hazard symbols in this image. Identify UN codes and describe the specific solution for this shipment.");
        fd.append("lang", lang);
        fd.append("image_data", laLecturaDirecta);

        try {
            const res = await fetch('https://smartcargo-aipa.onrender.com/advisory', { 
                method: 'POST', 
                body: fd 
            });
            const data = await res.json();
            output.innerHTML = "<b>INFORME T√âCNICO:</b>\n" + (data.data || "Sin respuesta.");
        } catch(err) {
            output.innerHTML = "Error de conexi√≥n. Aseg√∫rese de que Render est√© activo.";
        } finally {
            btn.disabled = false;
        }
    }
</script>

<script src="app.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SmartCargo-AIPA | Avianca HUB</title>
    <style>
        :root { --red: #d32f2f; --gold: #c5a059; --dark: #0a192f; --white: #ffffff; }
        body { background: #000; margin: 0; font-family: 'Segoe UI', sans-serif; color: var(--white); }
        .container { padding: 10px; max-width: 600px; margin: auto; }
        .header { text-align: center; border-bottom: 2px solid var(--gold); padding-bottom: 10px; }
        .card { background: var(--white); border-radius: 15px; padding: 15px; color: #333; margin-top: 10px; }
        .shield { background: var(--red); color: white; padding: 5px; font-size: 10px; text-align: center; border-radius: 5px; }
        
        /* Fotos con Zoom */
        .photo-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 10px 0; }
        .photo-box { height: 110px; border: 2px dashed var(--gold); border-radius: 10px; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; cursor: zoom-in; }
        .photo-box img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s; }
        
        /* Bot√≥n de Voz Push-to-Talk */
        .btn-voice { width: 100%; padding: 15px; background: var(--dark); color: var(--gold); border: 2px solid var(--gold); border-radius: 12px; font-weight: bold; margin: 10px 0; touch-action: none; cursor: pointer; }
        .btn-voice:active { background: var(--red); color: white; }

        input, textarea { width: 100%; padding: 10px; margin-bottom: 8px; border-radius: 8px; border: 1px solid #ccc; font-size: 14px; box-sizing: border-box; }
        .btn-exec { width: 100%; padding: 18px; background: var(--red); color: white; border: none; border-radius: 10px; font-weight: bold; font-size: 16px; cursor: pointer; text-transform: uppercase; }
        
        #resBox { display: none; margin-top: 15px; padding: 15px; border-left: 6px solid var(--gold); background: #f1f1f1; border-radius: 8px; color: #000; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 style="margin:0; font-size: 22px;">SmartCargo-AIPA</h1>
            <small style="color:var(--gold)">Avianca Master Logistics Advisor</small>
        </div>
        <div class="shield">IATA / DOT / CBP / WAREHOUSE EXPERT</div>
        
        <div class="card">
            <input type="text" id="awb" placeholder="AWB / ULD NUMBER">
            
            <div style="display:flex; gap:5px;">
                <input type="number" id="L" placeholder="L (pulg)">
                <input type="number" id="W" placeholder="W (pulg)">
                <input type="number" id="H" placeholder="H (pulg)">
            </div>
            
            <div class="photo-grid">
                <div class="photo-box" onclick="zoom(this)"><img id="v1" style="display:none;"><span id="t1">üì∏ DOCS</span><input type="file" id="f1" hidden onchange="pv(event,'v1')"></div>
                <div class="photo-box" onclick="zoom(this)"><img id="v2" style="display:none;"><span id="t2">üì∏ CARGO</span><input type="file" id="f2" hidden onchange="pv(event,'v2')"></div>
            </div>

            <button class="btn-voice" id="voiceBtn">üé§ MANT√âN PARA DICTAR A SMARTCARGO</button>
            <textarea id="obs" placeholder="Describe el documento o la carga que ves..."></textarea>
            
            <button class="btn-exec" onclick="runAIPA()">EJECUTAR ASESOR√çA MAESTRA</button>

            <div id="resBox">
                <div id="resTxt" style="font-size:14px; white-space:pre-wrap; line-height:1.5;"></div>
                <button onclick="speak()" style="width:100%; padding:12px; margin-top:10px; background:var(--dark); color:white; border-radius:8px; font-weight:bold;">üîä ESCUCHAR LECCI√ìN T√âCNICA</button>
                <button onclick="window.print()" style="width:100%; padding:10px; margin-top:5px; background:white; color:#333; border:1px solid #333; border-radius:8px;">üìÑ IMPRIMIR REPORTE / PDF</button>
            </div>
        </div>
    </div>

    <script>
        // Funci√≥n de Zoom
        function zoom(el) {
            const img = el.querySelector('img');
            if(img.style.display === "none") { el.querySelector('input').click(); }
            else { 
                if (img.style.transform === "scale(2.5)") {
                    img.style.transform = "scale(1)";
                    img.style.zIndex = "1";
                } else {
                    img.style.transform = "scale(2.5)";
                    img.style.zIndex = "100";
                }
            }
        }

        function pv(e, id) {
            const r = new FileReader();
            r.onload = x => { const i = document.getElementById(id); i.src = x.target.result; i.style.display="block"; i.nextElementSibling.style.display="none"; };
            r.readAsDataURL(e.target.files[0]);
        }

        // Push-to-Talk (Voz a Texto)
        const voiceBtn = document.getElementById('voiceBtn');
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'es-ES';
        recognition.continuous = true;

        voiceBtn.onmousedown = voiceBtn.ontouchstart = (e) => {
            e.preventDefault();
            recognition.start();
            voiceBtn.innerText = "üî¥ SMARTCARGO ESCUCHANDO...";
        };

        voiceBtn.onmouseup = voiceBtn.ontouchend = () => {
            recognition.stop();
            voiceBtn.innerText = "üé§ MANT√âN PARA DICTAR A SMARTCARGO";
        };

        recognition.onresult = (e) => {
            document.getElementById('obs').value = e.results[e.results.length - 1][0].transcript;
        };

        async function runAIPA() {
            document.getElementById('resBox').style.display = "block";
            document.getElementById('resTxt').innerText = "Consultando base de datos de IATA y Avianca Hub...";

            const fd = new FormData();
            fd.append('prompt', document.getElementById('obs').value);
            fd.append('awb', document.getElementById('awb').value);
            fd.append('lang', 'ES');
            fd.append('l', document.getElementById('L').value);
            fd.append('w', document.getElementById('W').value);
            fd.append('h', document.getElementById('H').value);

            const res = await fetch('/advisory', { method: 'POST', body: fd });
            const json = await res.json();
            document.getElementById('resTxt').innerText = json.data;
        }

        function speak() {
            window.speechSynthesis.speak(new SpeechSynthesisUtterance(document.getElementById('resTxt').innerText));
        }
    </script>
</body>
</html>

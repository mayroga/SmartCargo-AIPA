<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartCargo Advisory | May Roga</title>
    <style>
        :root { --red: #d32f2f; --gold: #c5a059; --black: #050505; --white: #ffffff; --gray: #1a1a1a; }
        body { background: var(--black); color: var(--white); font-family: 'Helvetica Neue', Arial, sans-serif; margin: 0; padding: 20px; }
        
        .header { text-align: center; border-bottom: 2px solid var(--gold); padding-bottom: 10px; margin-bottom: 20px; }
        .advisor-name { color: var(--gold); font-weight: bold; font-size: 1.2em; letter-spacing: 1px; }

        .lang-switch { display: flex; justify-content: flex-end; gap: 10px; margin-bottom: 15px; }
        .lang-btn { background: transparent; border: 1px solid var(--gold); color: var(--gold); padding: 5px 15px; cursor: pointer; border-radius: 4px; }
        .lang-btn.active { background: var(--gold); color: var(--black); }

        .input-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; margin-bottom: 20px; }
        input, textarea { background: var(--gray); border: 1px solid #333; color: var(--white); padding: 15px; border-radius: 8px; font-size: 16px; width: 100%; box-sizing: border-box; }
        input:focus { border-color: var(--gold); outline: none; }

        .button-zone { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; }
        button { padding: 18px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; }
        .btn-voice { background: var(--gold); color: var(--black); grid-column: span 2; font-size: 1.1em; }
        .btn-resolve { background: var(--red); color: var(--white); }
        .btn-clear { background: #444; color: var(--white); }

        #output { 
            display: none; background: var(--white); color: var(--black); 
            padding: 30px; margin-top: 25px; border-radius: 12px; 
            line-height: 1.8; font-size: 17px; white-space: pre-wrap; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .btn-print { width: 100%; margin-top: 20px; background: var(--black); color: var(--gold); border: 2px solid var(--gold); }

        table { width: 100%; border-collapse: collapse; margin: 20px 0; background: #f9f9f9; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background: #eee; }

        @media print {
            body { background: white; color: black; padding: 0; }
            .header, .input-group, button, .lang-switch, textarea { display: none !important; }
            #output { display: block !important; border: none; box-shadow: none; padding: 0; }
        }
    </style>
</head>
<body>

<div class="lang-switch">
    <button class="lang-btn" id="btn-en" onclick="setLang('en')">English</button>
    <button class="lang-btn" id="btn-es" onclick="setLang('es')">Espa√±ol</button>
</div>

<div class="header">
    <div class="advisor-name">SMARTCARGO ADVISORY by MAY ROGA</div>
    <div style="font-size: 10px; color: #888; margin-top: 5px;">AIR FREIGHT SPECIALIST CONSOLE</div>
</div>

<div class="input-group">
    <input type="text" id="awb" placeholder="AWB / ULD">
    <input type="number" id="L" placeholder="Length">
    <input type="number" id="W" placeholder="Width">
    <input type="number" id="H" placeholder="Height">
    <input type="number" id="wgt" placeholder="Weight">
</div>

<button class="btn-voice" id="voiceBtn">üé§ PRESS & HOLD TO DICTATE</button>
<textarea id="obs" rows="4" placeholder="Describe the cargo situation, documents, or request a classification..."></textarea>

<div class="button-zone">
    <button class="btn-clear" onclick="clearAll()">üóëÔ∏è Clear</button>
    <button class="btn-resolve" onclick="resolve()">Resolve / Resolver</button>
</div>

<div id="output">
    <div id="resTxt"></div>
    <button class="btn-print" onclick="window.print()">üìÑ SAVE AS PDF / PRINT</button>
</div>

<script>
    let currentLang = 'en';
    function setLang(l) {
        currentLang = l;
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-' + l).classList.add('active');
    }
    setLang('en');

    const voiceBtn = document.getElementById('voiceBtn');
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'en-US';

    voiceBtn.onmousedown = voiceBtn.ontouchstart = (e) => {
        e.preventDefault();
        recognition.lang = (currentLang === 'es') ? 'es-ES' : 'en-US';
        recognition.start();
        voiceBtn.style.background = "red";
    };
    voiceBtn.onmouseup = voiceBtn.ontouchend = () => {
        recognition.stop();
        voiceBtn.style.background = "";
    };
    recognition.onresult = (e) => {
        document.getElementById('obs').value += " " + e.results[0][0].transcript;
    };

    function clearAll() {
        document.querySelectorAll('input, textarea').forEach(i => i.value = "");
        document.getElementById('output').style.display = "none";
    }

    async function resolve() {
        const out = document.getElementById('output');
        const txt = document.getElementById('resTxt');
        out.style.display = "block";
        txt.innerText = "Analyzing / Analizando...";

        const fd = new FormData();
        fd.append('prompt', document.getElementById('obs').value);
        fd.append('awb', document.getElementById('awb').value);
        fd.append('l', document.getElementById('L').value || "0");
        fd.append('w', document.getElementById('W').value || "0");
        fd.append('h', document.getElementById('H').value || "0");
        fd.append('wgt', document.getElementById('wgt').value || "0");
        fd.append('lang', currentLang);

        const res = await fetch('/advisory', { method: 'POST', body: fd });
        const result = await res.json();
        
        // Formateo de respuesta para PDF limpio
        txt.innerHTML = result.data.replace(/\n/g, "<br>");
    }
</script>
</body>
</html>
